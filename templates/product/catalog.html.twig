{% extends "base.html.twig" %}

{% block title %}
	{% if filter == "all" %}
		Notre catalogue
	{% else %}
		Nos {{filter}}s
	{% endif %} • Yellow
{% endblock %}
{% block body %}
	<link rel="stylesheet" href="/css/catalog.css">
	<main>
		<h1>
			{% if filter == "all" %}
				Tous nos mangas
			{% else %}
				Nos {{filter}}s
			{% endif %}
		</h1>
		<form method="GET">
		<div class="form-group">
				<label for="stock">Filtrer par produit en stock :</label>
				<select type="text" class="form-control" id="stock_search" name="stock_search" onchange="chargeURL()">
						<option value="all" selected>Tous les produits</option>
						{% if stocks > 0 %}
							<option {{ stocks == stock_search ? 'selected'}} selected>Les produits en stock</option>
						{% endif %}
				</select>
			</form>
		</div>
		<div class="searchbar">
			<form method="POST" class="search-form">
				<input class="search-input" id="search" name="query" type="search" placeholder="Rechercher un produit">
				<button type="submit" class="btn-search"><ion-icon name="search-outline" size="large"></ion-icon></button>
			</form>
			<script>
				// Send form with search query
				document.querySelector(".search-form").addEventListener("submit", e => {
					e.preventDefault();
					const url = "{{path('search', {query: 'search-value'})}}"
						.replace("search-value", e.target.children[0].value);
					e.target.setAttribute("action", url);
					e.target.submit()
				})
			</script>
		</div>
		<div class="catalog-container">
			{% for product in products %}
				{% if product.productStock %}
					<a href="{{path('product', {id: product.id})}}" class="product" style="background-image: url(/images/cover/{{product.productCover}}.jpg)">
						<div class="product-footer">
							<div class="product-primary-info">
								<div class="product-info">
									<span class="product-title">{{product.productName}}</span>
									<div class="product-subtitle">
										{{product.productAuthor}} •<span class="product-date">{{product.productDate}}</span>
									</div>
								</div>
								<div class="product-price">{{product.productPrice}}€</div>
							</div>
							<div class="product-desc">{{product.productDesc}}</div>
						</div>
					</a>
				{% endif %}
			{% endfor %}
		</div>
		<div class="page-container">
		{% if previous >= 0 %}
		<a href="{{ path('catalog', { offset: previous, category: 'all' }) }}" class="page">
			<ion-icon name="chevron-back"></ion-icon> 
		</a>
		{% if offset == 8 %}
		2/3
		{% endif %}
		{% if offset == 16 %}
		3/3
		{% endif %}
		{% endif %}
		{% if next < products|length %}
		{% if offset == 0 %}
		1/3
		{% endif %}
		<a href="{{ path('catalog', { offset: next, category: 'all' }) }}" class="page">
			<ion-icon name="chevron-forward"></ion-icon>
		</a>
		{% endif %}
		</div>
	</main>
	<script>
		const filterByCategory = () => {
			const form = document.querySelector("#form-search-by-category"),
				url = "{{path('catalog', {category: 'value'})}}"
					.replace("value", form.querySelector("#select-category").value);
			form.setAttribute("action", url);
			form.submit()
		}
		function chargeURL()
		{
		window.location.href=document.getElementById('stock_search').value;
		}
	</script>
{% endblock %}